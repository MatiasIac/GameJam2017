<html>
    <!-- Game code developed by Matias Iacono, Patricio Marrone, with art from Carla Corcoba and Alejandro -->
    <body>
        <canvas id="canvas" width="640" height="480"></canvas>

        <script language="Javascript" src="framework/jsGFwk.js"></script>
        <script language="Javascript" src="framework/jsGFwk2dFastAnimation.js"></script>
        <script language="Javascript" src="framework/jsGFwkFonts.js"></script>
        <script language="Javascript" src="framework/jsGFwkIO.js"></script>
        <script language="Javascript" src="framework/jsGFwkCollisions.js"></script>
        <script language="Javascript" src="framework/jsGFwkContainer.js"></script>
        <script language="Javascript" src="framework/jsGFwkGamepad.js"></script>
        <script language="Javascript" src="framework/jsGFwkRM.js"></script>
	    <script language="Javascript" src="framework/jsGFwkSprites.js"></script>
        <script language="Javascript" src="framework/jsGFwkWebStorage.js"></script>
        <script language="Javascript" src="framework/jsGFwkScenes.js"></script>
        <script language="Javascript" src="framework/jsGFwkWebStorage.js"></script>
        <script language="Javascript" src="framework/jsGFwkGamepad.js"></script>
        <script language="Javascript" src="framework/jsGFwkUtils.js"></script>
        <script language="Javascript" src="framework/jsGFwkTimers.js"></script>
        <script language="Javascript" src="framework/alarm.js"></script>
        <script language="Javascript" src="curve.js"></script>
        <script language="Javascript" src="block.js"></script>
        <script language="Javascript" src="levelController.js"></script>
        <script language="Javascript" src="mapBuilder.js"></script>
        <script language="Javascript" src="foreground.js"></script>
        <script language="Javascript" src="background.js"></script>
        <script language="Javascript" src="particles.js"></script>
        <script>

            jsGFwk.settings.canvas = "canvas";
            jsGFwk.settings.clearColor = "black";
            jsGFwk.settings.frameRate = 1000 / 60;

            jsGFwk.include("FastAnimation");
            jsGFwk.include("IO");
            jsGFwk.include("Collisions");
            jsGFwk.include("Gamepad");
            jsGFwk.include("ResourceManager");
    		jsGFwk.include("Sprites");
            jsGFwk.include("Fonts");
            jsGFwk.include("Storage");
            jsGFwk.include("Scenes");
            jsGFwk.include("Utils");

            jsGFwk.Fonts.createFont({ name: 'zxBold', source: 'fonts/zxBold.ttf' });
            jsGFwk.Fonts.createFont({ name: 'open24display', source: 'fonts/open24display.ttf' });

            var globalObjects = { };
            var splash = new Image();

            splash.onload = function () {
                jsGFwk.start();
            };
            splash.src = "images/intro.png";

            jsGFwk.ResourceManager.addGraphic({ name: "intro", source: "images/intro.png" });
            jsGFwk.ResourceManager.addGraphic({ name: "map1", source: "images/map1.png" });
            jsGFwk.ResourceManager.addGraphic({ name: "map2", source: "images/map2.png" });
            jsGFwk.ResourceManager.addGraphic({ name: "map3", source: "images/map3.png" });
            jsGFwk.ResourceManager.addGraphic({ name: "map4", source: "images/map4.png" });
            jsGFwk.ResourceManager.addGraphic({ name: "foreground", source: "images/foreground.png" });
            jsGFwk.ResourceManager.addGraphic({ name: "background", source: "images/background.png" });
            jsGFwk.ResourceManager.addGraphic({	name: "ball", source: "images/ball.png" });
            jsGFwk.ResourceManager.addGraphic({	name: "balldie", source: "images/ball-die.png" });
            jsGFwk.ResourceManager.addGraphic({	name: "blueball", source: "images/blueball.png" });
            jsGFwk.ResourceManager.addGraphic({	name: "redball", source: "images/redball.png" });
            jsGFwk.ResourceManager.addGraphic({	name: "greenball", source: "images/greenball.png" });

            jsGFwk.createObject({
                id: "progress",
                visible: true,
                barWidth: 0,
                init: function() {
                    jsGFwk.ResourceManager.onResourcesLoadedCompleted = function() {

                        jsGFwk.Sprites.createSpriteCollection("player",
                            jsGFwk.ResourceManager.graphics.ball.image,
                                jsGFwk.Utils.makeAtlas(40, 40, 24, false));
                        jsGFwk.Sprites.player.loop(true);

                        jsGFwk.Sprites.createSpriteCollection("playerDead",
                            jsGFwk.ResourceManager.graphics.balldie.image,
                                jsGFwk.Utils.makeAtlas(40, 40, 11, false));

                        jsGFwk.Sprites.createSpriteCollection("enemy",
                            jsGFwk.ResourceManager.graphics.redball.image,
                                jsGFwk.Utils.makeAtlas(40, 40, 12, false));
                        jsGFwk.Sprites.enemy.loop(true);

                        jsGFwk.Sprites.createSpriteCollection("blue",
                            jsGFwk.ResourceManager.graphics.blueball.image,
                                jsGFwk.Utils.makeDoubleAtlas(40, 40, 12, true));
                        jsGFwk.Sprites.blue.loop(true);

                        jsGFwk.Sprites.createSpriteCollection("green",
                            jsGFwk.ResourceManager.graphics.greenball.image,
                                jsGFwk.Utils.makeAtlas(40, 40, 12, false));
                        jsGFwk.Sprites.green.loop(true);

                        globalObjects.blockContainer = jsGFwk.Container.createContainer('block', Block, true);
                        globalObjects.particleContainer = jsGFwk.Container.createContainer('particle', Particle, true);

                        jsGFwk.Scenes.create({name: "game",
                            gameObjects: [Background,
                                          globalObjects.blockContainer,
                                          Curve,
                                          globalObjects.particleContainer,
                                          LevelController,
                                          //Foreground,
                                          ]});

                        jsGFwk.Scenes.scenes.game.enable();
                        jsGFwk._gameObjects.progress.destroy();
                    };
                },
                update: function(delta) {
                },
                draw: function (context) {
                    context.drawImage(splash, 10, 10);
                    context.fillStyle = "white";
                    context.font = "11pt times";
                    context.fillText("Loading...", 250, 220);
                }
            });
        </script>
    </body>
</html>
